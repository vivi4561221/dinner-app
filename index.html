<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å¤œã”é£¯ãƒ¡ãƒ¼ã‚¿ãƒ¼ Ã— ã”ã¯ã‚“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #fff7f2;
  padding: 10px;
}
h1 { text-align:center; color:#ff7a7a; }

.card {
  background: white;
  border-radius: 14px;
  padding: 12px;
  margin-bottom: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

input, textarea, select, button {
  width: 100%;
  margin-top: 6px;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ddd;
}
button {
  background: #ff7a7a;
  color: white;
  border: none;
}

.top-bar {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 6px;
}
.setting-btn {
  background: none;
  color: #ff7a7a;
  font-size: 18px;
  border: none;
}

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
}
.day {
  background: white;
  border-radius: 10px;
  padding: 6px;
  min-height: 80px;
  font-size: 11px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.day-number { font-weight:bold; }
.meal { font-size: 10px; }

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
}
.modal-content {
  background: white;
  padding: 20px;
  border-radius: 16px;
  width: 90%;
}

.small-btn {
  font-size: 12px;
  background: none;
  color: #999;
  border: none;
}
</style>
</head>
<body>

<h1>å¤œã”é£¯ãƒ¡ãƒ¼ã‚¿ãƒ¼ ğŸ½ï¸ğŸ“…</h1>

<!-- è¨­å®šãƒœã‚¿ãƒ³ -->
<div class="top-bar">
  <button class="setting-btn" onclick="toggleRecipes()">âš™ï¸ ãƒ¬ã‚·ãƒ”ç®¡ç†</button>
</div>

<!-- ãƒ¬ã‚·ãƒ”ç®¡ç†ã‚¨ãƒªã‚¢ï¼ˆæ™®æ®µã¯éè¡¨ç¤ºï¼‰ -->
<div id="recipeArea" style="display:none;">
  <div class="card">
    <h3>ãƒ¬ã‚·ãƒ”ç™»éŒ²</h3>
    <input id="recipeName" placeholder="æ–™ç†å">
    <textarea id="recipeText" placeholder="ãƒ¬ã‚·ãƒ”ï¼ˆä»»æ„ï¼‰"></textarea>
    <button id="recipeBtn" onclick="addOrUpdateRecipe()">è¿½åŠ </button>
  </div>

  <div class="card">
    <h3>ãƒ¬ã‚·ãƒ”ä¸€è¦§</h3>
    <div id="recipeList"></div>
  </div>
</div>

<!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
<div class="card">
  <h3>ã”ã¯ã‚“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
  <div class="calendar" id="calendar"></div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalDate"></h3>

    <select id="mealType">
      <option value="morning">æœ</option>
      <option value="lunch">æ˜¼</option>
      <option value="dinner">æ™©</option>
    </select>

    <select id="mealSelect"></select>

    <button onclick="saveMeal()">ä¿å­˜</button>
    <button class="small-btn" onclick="closeModal()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<script>
// -------- ãƒ‡ãƒ¼ã‚¿ --------
let recipes = JSON.parse(localStorage.getItem("recipes") || "[]");
let calendarData = JSON.parse(localStorage.getItem("mealCalendar") || "{}");
let currentDate = "";
let editingIndex = null;

// -------- ãƒˆã‚°ãƒ« --------
function toggleRecipes(){
  const area = document.getElementById("recipeArea");
  area.style.display = area.style.display === "none" ? "block" : "none";
}

// -------- ãƒ¬ã‚·ãƒ” --------
function addOrUpdateRecipe(){
  if(!recipeName.value) return alert("æ–™ç†åå…¥ã‚Œã¦");

  if(editingIndex === null){
    recipes.push({
      id: Date.now(),
      name: recipeName.value,
      recipe: recipeText.value
    });
  } else {
    recipes[editingIndex].name = recipeName.value;
    recipes[editingIndex].recipe = recipeText.value;
    editingIndex = null;
    recipeBtn.innerText = "è¿½åŠ ";
  }

  localStorage.setItem("recipes", JSON.stringify(recipes));
  recipeName.value = "";
  recipeText.value = "";
  renderRecipes();
  renderMealSelect();
}

function editRecipe(index){
  const r = recipes[index];
  recipeName.value = r.name;
  recipeText.value = r.recipe;
  editingIndex = index;
  recipeBtn.innerText = "æ›´æ–°ã™ã‚‹";
  toggleRecipes(); // ç®¡ç†ç”»é¢ã‚’é–‹ã
}

function renderRecipes(){
  recipeList.innerHTML = "";
  recipes.forEach((r,i)=>{
    const div = document.createElement("div");
    div.innerHTML = `
      <strong>${r.name}</strong>
      <button class="small-btn" onclick="editRecipe(${i})">âœï¸</button>
      <button class="small-btn" onclick="deleteRecipe(${i})">âœ•</button>
      <div style="font-size:12px;color:#666">${r.recipe || ""}</div>
    `;
    recipeList.appendChild(div);
  });
}

function deleteRecipe(index){
  if(!confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
  recipes.splice(index,1);
  localStorage.setItem("recipes", JSON.stringify(recipes));
  renderRecipes();
  renderMealSelect();
}

// -------- ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ --------
function renderMealSelect(){
  mealSelect.innerHTML = "";
  const first = document.createElement("option");
  first.value = "";
  first.textContent = "æ–™ç†ã‚’é¸ã‚“ã§ãã ã•ã„";
  mealSelect.appendChild(first);

  recipes.forEach(r=>{
    const opt = document.createElement("option");
    opt.value = r.name;
    opt.textContent = r.name;
    mealSelect.appendChild(opt);
  });
}

// -------- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ --------
function renderCalendar(){
  const cal = document.getElementById("calendar");
  cal.innerHTML = "";
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  const last = new Date(year, month+1, 0).getDate();

  for(let d=1; d<=last; d++){
    const key = `${year}-${month+1}-${d}`;
    const dayData = calendarData[key] || {};
    const div = document.createElement("div");
    div.className = "day";
    div.onclick = ()=>openModal(key);
    div.innerHTML = `
      <div class="day-number">${d}</div>
      <div class="meal">ğŸŒ… ${dayData.morning || ""}</div>
      <div class="meal">â˜€ï¸ ${dayData.lunch || ""}</div>
      <div class="meal">ğŸŒ™ ${dayData.dinner || ""}</div>
    `;
    cal.appendChild(div);
  }
}

// -------- ãƒ¢ãƒ¼ãƒ€ãƒ« --------
function openModal(key){
  currentDate = key;
  modal.style.display = "flex";
  modalDate.innerText = key;
  mealSelect.value = "";
}

function closeModal(){
  modal.style.display = "none";
}

function saveMeal(){
  const type = mealType.value;
  const name = mealSelect.value;
  if(!name) return alert("æ–™ç†ã‚’é¸ã‚“ã§");

  if(!calendarData[currentDate]) {
    calendarData[currentDate] = {};
  }
  calendarData[currentDate][type] = name;

  localStorage.setItem("mealCalendar", JSON.stringify(calendarData));
  closeModal();
  renderCalendar();
}

// åˆæœŸè¡¨ç¤º
renderRecipes();
renderMealSelect();
renderCalendar();
</script>

</body>
</html>

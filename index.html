<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å¤œã”é£¯ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      background: #fff7f2;
      margin: 0;
      padding: 20px;
    }
    h1 { text-align: center; color: #ff7a7a; margin-bottom: 10px; }
    .card {
      background: white; border-radius: 16px; padding: 15px;
      margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    input, button {
      width: 100%; font-size: 16px; padding: 10px;
      margin-top: 8px; border-radius: 10px; border: 1px solid #ddd;
    }
    button { background: #ff7a7a; color: white; border: none; margin-top: 12px; }
    .item { margin-bottom: 20px; }
    .item img { width: 100%; border-radius: 12px; margin-top: 8px; }
    .date { font-size: 12px; color: #999; }
    .week { margin-top: 10px; }
    .week div { margin: 4px 0; }
  </style>
</head>
<body>

  <h1>å¤œã”é£¯ãƒ¡ãƒ¼ã‚«ãƒ¼ ğŸ½ï¸</h1>

  <div class="card">
    <input id="menuInput" placeholder="æ–™ç†å">
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="addMenu()">ç™»éŒ²</button>
  </div>

  <div class="card">
    <button onclick="generateWeek()">ä»Šé€±ã®çŒ®ç«‹ã‚’ä½œã‚‹</button>
    <div id="weekPlans"></div>
  </div>

  <div class="card">
    <h2>å±¥æ­´</h2>
    <div id="menuList"></div>
  </div>

  <script>
    let data = JSON.parse(localStorage.getItem("menus") || "[]");

    function save() {
      localStorage.setItem("menus", JSON.stringify(data));
    }

    function addMenu() {
      const menu = menuInput.value;
      const file = imageInput.files[0];
      if (!menu || !file) return alert("æ–™ç†åã¨å†™çœŸã‚’å…¥ã‚Œã¦ãã ã•ã„");

      const reader = new FileReader();
      reader.onload = function(e) {
        data.unshift({
          menu,
          date: new Date().toLocaleDateString(),
          image: e.target.result
        });
        save();
        render();
        menuInput.value = "";
        imageInput.value = "";
      };
      reader.readAsDataURL(file);
    }

    function render() {
      menuList.innerHTML = "";
      data.forEach(d => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <strong>${d.menu}</strong>
          <div class="date">${d.date}</div>
          <img src="${d.image}">
        `;
        menuList.appendChild(div);
      });
    }

    // ===== ã“ã“ã‹ã‚‰é€±é–“çŒ®ç«‹ãƒ­ã‚¸ãƒƒã‚¯ =====

    const days = ["æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ","æ—¥"];

    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    function generateOneWeek() {
      const recent = data.slice(0, 7).map(d => d.menu);
      const candidates = data.filter(d => !recent.includes(d.menu));
      const pool = candidates.length >= 7 ? candidates : data;
      const shuffled = shuffle([...pool]);
      return shuffled.slice(0, 7);
    }

    function generateWeek() {
      if (data.length < 7) {
        alert("æœ€ä½7å€‹ä»¥ä¸Šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„");
        return;
      }

      const planA = generateOneWeek();
      const planB = generateOneWeek();
      const planC = generateOneWeek();

      weekPlans.innerHTML = `
        <h3>æ¡ˆAï¼ˆãƒãƒ©ãƒ³ã‚¹ï¼‰</h3>
        <div class="week">${renderWeek(planA)}</div>
        <h3>æ¡ˆBï¼ˆç°¡å˜ï¼‰</h3>
        <div class="week">${renderWeek(planB)}</div>
        <h3>æ¡ˆCï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼‰</h3>
        <div class="week">${renderWeek(planC)}</div>
      `;
    }

    function renderWeek(plan) {
      return plan.map((p, i) =>
        `<div>${days[i]}ï¼š${p.menu}</div>`
      ).join("");
    }

    render();
  </script>
</body>
</html>
